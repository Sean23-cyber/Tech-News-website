<script>
// Sample article data (in a real app, this would come from an API)
const articles = [
  {
    id: 1,
    title: "New AI Model Breaks Record in Natural Language Processing",
    excerpt: "A new large language model released this week shows unprecedented accuracy in complex reasoning tasks.",
    category: "ai",
    date: "2025-03-28",
    author: "James Wilson",
    image: "https://source.unsplash.com/random/600x400/?ai"
  },
  {
    id: 2,
    title: "Major Financial Institutions Report New Wave of Sophisticated Attacks",
    excerpt: "Security experts warn of a new type of ransomware targeting banking infrastructure.",
    category: "security",
    date: "2025-03-29",
    author: "Sarah Chen",
    image: "https://source.unsplash.com/random/600x400/?cybersecurity"
  },
  // Add more articles as needed...
];

// DOM Elements
const searchInput = document.getElementById('search-input');
const searchButton = document.getElementById('search-button');
const categoryFilter = document.getElementById('category-filter');
const dateFilter = document.getElementById('date-filter');
const applyFilters = document.getElementById('apply-filters');
const resetFilters = document.getElementById('reset-filters');
const filterResults = document.getElementById('filter-results');
const pagination = document.getElementById('pagination');
const toast = document.getElementById('toast-notification');

// Current state
let currentPage = 1;
const articlesPerPage = 8;
let filteredArticles = [...articles];

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  displayArticles(filteredArticles);
  setupEventListeners();
});

function setupEventListeners() {
  // Search functionality
  searchButton.addEventListener('click', performSearch);
  searchInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') performSearch();
  });

  // Filter functionality
  applyFilters.addEventListener('click', applyArticleFilters);
  resetFilters.addEventListener('click', resetArticleFilters);
}

function performSearch() {
  const searchTerm = searchInput.value.trim().toLowerCase();
  
  if (searchTerm === '') {
    showToast('Please enter a search term');
    return;
  }

  filteredArticles = articles.filter(article => 
    article.title.toLowerCase().includes(searchTerm) ||
    article.excerpt.toLowerCase().includes(searchTerm) ||
    article.category.toLowerCase().includes(searchTerm) ||
    article.author.toLowerCase().includes(searchTerm)
  );

  if (filteredArticles.length === 0) {
    showToast('No articles found matching your search', 'error');
  } else {
    showToast(`Found ${filteredArticles.length} articles`);
  }

  currentPage = 1;
  displayArticles(filteredArticles);
}

function applyArticleFilters() {
  const category = categoryFilter.value;
  const sortOrder = dateFilter.value;

  // Filter by category
  filteredArticles = category === 'all' 
    ? [...articles] 
    : articles.filter(article => article.category === category);

  // Sort by date
  filteredArticles.sort((a, b) => {
    const dateA = new Date(a.date);
    const dateB = new Date(b.date);
    return sortOrder === 'newest' ? dateB - dateA : dateA - dateB;
  });

  currentPage = 1;
  displayArticles(filteredArticles);
  showToast('Filters applied');
}

function resetArticleFilters() {
  categoryFilter.value = 'all';
  dateFilter.value = 'newest';
  filteredArticles = [...articles];
  currentPage = 1;
  displayArticles(filteredArticles);
  showToast('Filters reset');
}

function displayArticles(articlesToDisplay) {
  // Show loading state
  filterResults.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Loading articles...</div>';

  // Simulate API delay
  setTimeout(() => {
    const startIndex = (currentPage - 1) * articlesPerPage;
    const paginatedArticles = articlesToDisplay.slice(startIndex, startIndex + articlesPerPage);

    if (paginatedArticles.length === 0) {
      filterResults.innerHTML = '<div class="no-results">No articles found matching your criteria</div>';
      pagination.innerHTML = '';
      return;
    }

    // Clear previous results
    filterResults.innerHTML = '';

    // Add articles to DOM
    paginatedArticles.forEach(article => {
      const articleEl = document.createElement('div');
      articleEl.className = 'news-card';
      articleEl.innerHTML = `
        <div class="news-image" style="background-image: url('${article.image}')"></div>
        <div class="news-content">
          <h3 class="news-title">
            <a href="#">${article.title}</a>
          </h3>
          <p class="news-excerpt">${article.excerpt}</p>
          <div class="news-meta">
            <span>${formatDate(article.date)}</span>
            <span>By ${article.author}</span>
            <span class="article-category">${article.category.toUpperCase()}</span>
          </div>
        </div>
      `;
      filterResults.appendChild(articleEl);
    });

    // Add pagination
    renderPagination(articlesToDisplay.length);
  }, 500);
}

function renderPagination(totalArticles) {
  const totalPages = Math.ceil(totalArticles / articlesPerPage);
  
  if (totalPages <= 1) {
    pagination.innerHTML = '';
    return;
  }

  let paginationHTML = '';
  
  // Previous button
  paginationHTML += `
    <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
      <i class="fas fa-chevron-left"></i>
    </button>
  `;

  // Page numbers
  for (let i = 1; i <= totalPages; i++) {
    paginationHTML += `
      <button onclick="changePage(${i})" ${i === currentPage ? 'class="active"' : ''}>
        ${i}
      </button>
    `;
  }

  // Next button
  paginationHTML += `
    <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
      <i class="fas fa-chevron-right"></i>
    </button>
  `;

  pagination.innerHTML = paginationHTML;
}

// Global function for pagination buttons
window.changePage = function(newPage) {
  currentPage = newPage;
  displayArticles(filteredArticles);
  window.scrollTo({ top: filterResults.offsetTop - 100, behavior: 'smooth' });
};

function formatDate(dateString) {
  const options = { year: 'numeric', month: 'long', day: 'numeric' };
  return new Date(dateString).toLocaleDateString('en-US', options);
}

function showToast(message, type = 'success') {
  toast.textContent = message;
  toast.className = 'toast show';
  if (type === 'error') toast.classList.add('error');
  
  setTimeout(() => {
    toast.className = 'toast';
  }, 3000);
}
</script>
